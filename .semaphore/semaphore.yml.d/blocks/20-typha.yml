- name: Typha
  run:
    when: "${CHANGE_IN(typha)}"
  dependencies:
    - Prerequisites
  task:
    prologue:
      commands:
        - cd typha
    jobs:
      - name: "Typha: UT and FV tests"
        commands:
          - ../.semaphore/run-and-monitor make-ci.log make ci EXCEPT=k8sfv-test
      - name: "Typha: UT and FV tests on UBI-minimal"
        commands:
          - ../.semaphore/run-and-monitor make-fv-ubi.log make clean image fv
        env_vars:
          - name: USE_UBI_AS_CALICO_BASE
            value: '1'
    epilogue:
      always:
        commands:
          - test-results publish ./report/*.xml --name "Typha: UT" || true
          - test-results publish ../felix/report/*.xml --name "Typha: k8sfv" || true
