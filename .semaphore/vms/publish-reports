#!/bin/bash

set -e
set -x

job_tag="$1"

my_dir="$(dirname $0)"
repo_dir="$my_dir/../.."
artifacts_dir="${repo_dir}/artifacts"

echo "Publishing any reports from the artifacts directory."

cd "$artifacts_dir"

if [ "$COMPONENT" = "felix" ]; then
  # The UTs get lost amongst the FVs, so split them into separate reports.
  find . -name '*.xml' -print0 | grep -z '_fv_' | xargs -r -0 test-results publish --name "$job_tag: FV"
  find . -name '*.xml' -print0 | grep -z -v '_fv_' | xargs -r -0 test-results publish --name "$job_tag: UT"
else
  find . -name '*.xml' -print0 | xargs -r -0 test-results publish --name "$job_tag"
fi