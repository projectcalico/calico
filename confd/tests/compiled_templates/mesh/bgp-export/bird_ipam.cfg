# Generated by confd
function reject_disabled_pools ()
{

  # Skip 192.168.1.0/24 as BGP export is disabled for it
  if ( net ~ 192.168.2.0/24 ) then { reject; }
  # Skip 192.168.3.0/24 as BGP export is disabled for it
}

function reject_tunnel_routes () {
  # Don't export tunnel routes to other nodes, Felix programs them.
  # IPIP routes are handled by Bird, and it does not re-advertise them.
  if (defined(ifname)) then {
     if ((ifname ~ "*.cali") || (ifname ~ "*.calico")) then {
        reject;
     }
  }
}

function reject_local_routes () {
  # Don't export local routes learned via BPF as they should never leave the node.
  if (defined(ifname)) then {
     if (ifname ~ "bpf*.cali") then {
        reject;
     }
  }
}

function export_static_routes () {
}

function export_loadbalancer_ips () {
}

function calico_export_to_bgp_peers(bool internal_peer) {
  # filter code terminates when it calls `accept;` or `reject;`,
  reject_disabled_pools();
  if (internal_peer) then {
    reject_tunnel_routes();
  }
  reject_local_routes();
  apply_communities();
  calico_aggr();
  export_static_routes();
  export_loadbalancer_ips();
}


filter calico_kernel_programming {

  if ( net ~ 192.168.1.0/24 ) then {
    krt_tunnel = "";
    accept;
  }

  if ( net ~ 192.168.2.0/24 ) then {
    krt_tunnel = "";
    accept;
  }

  if ( net ~ 192.168.3.0/24 ) then {
    krt_tunnel = "";
    accept;
  }

  accept;
}
