# Generated by confd
function reject_disabled_pools () {

}


function reject_ippools_routes() {
  if ( net ~ 192.168.0.0/16 ) then {
	# Don't program cluster routes into the kernel - these are handled by Felix.
	reject;
}

function reject_cluster_routes () {
  # Don't export cluster routes to other nodes, Felix programs them.
  if (defined(ifname)) then {
     if ((ifname ~ "*.cali") || (ifname ~ "*.calico")) then {
        reject;
     }
  }
  reject_ippools_routes();
}

function reject_local_routes () {
  # Don't export local routes learned via BPF as they should never leave the node.
  if (defined(ifname)) then {
     if (ifname ~ "bpf*.cali") then {
        reject;
     }
  }
}

function calico_export_to_bgp_peers(bool internal_peer) {
  # filter code terminates when it calls `accept;` or `reject;`,
  # call reject_disabled_pools() first, then reject_cluster_routes(),
  # then apply_communities() and then calico_aggr()
  reject_disabled_pools();
  if (internal_peer) then {
    reject_cluster_routes();
  }
  reject_local_routes();
  apply_communities();
  calico_aggr();

  # Export static routes.
  if ( net ~ 10.101.0.0/16 ) then { accept; }
  if ( net ~ 10.101.0.101/32 ) then { accept; }
  if ( net ~ 80.15.0.0/24 ) then { accept; }

  if ( net ~ 192.168.0.0/16 ) then {
    accept;
  }
}

filter calico_kernel_programming {

  # Don't program static routes into kernel.
  if ( net ~ 10.101.0.0/16 ) then { reject; }
  if ( net ~ 80.15.0.0/24 ) then { reject; }

  reject_ippools_routes();
  accept;
}
