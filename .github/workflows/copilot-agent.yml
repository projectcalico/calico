# GitHub Copilot Agent Configuration
# This workflow ensures that GitHub Copilot agent functionality
# runs on ubuntu-latest runner with proper configuration.

name: Copilot Agent

on:
  pull_request:
    paths:
      - '.github/copilot-instructions.md'
      - '.github/workflows/copilot-agent.yml'
  push:
    branches:
      - master
      - main
  workflow_dispatch: # Allow manual triggering

jobs:
  copilot-agent:
    name: Copilot Agent Configuration
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate Copilot Instructions
        run: |
          echo "Validating Copilot instructions file..."
          if [ -f ".github/copilot-instructions.md" ]; then
            echo "âœ“ Copilot instructions file exists"
            echo "âœ“ File size: $(wc -c < .github/copilot-instructions.md) bytes"
            echo "âœ“ Line count: $(wc -l < .github/copilot-instructions.md) lines"
          else
            echo "âœ— Copilot instructions file not found"
            exit 1
          fi

      - name: Check Runner Environment
        run: |
          echo "Copilot agent running on: ${{ runner.os }}"
          echo "Runner image: ${{ runner.image }}"
          echo "Architecture: $(uname -m)"
          echo "Ubuntu version: $(lsb_release -d | cut -f2)"
          echo "âœ“ Confirmed running on ubuntu-latest"

      - name: Verify Repository Structure
        run: |
          echo "Verifying repository structure for Copilot compatibility..."
          echo "âœ“ Repository root: $(pwd)"
          echo "âœ“ Git repository: $(test -d .git && echo 'Yes' || echo 'No')"
          echo "âœ“ Total files: $(find . -type f | wc -l)"
          echo "âœ“ Go files: $(find . -name '*.go' | wc -l)"
          echo "âœ“ YAML files: $(find . -name '*.yml' -o -name '*.yaml' | wc -l)"

      - name: Test Copilot Agent Environment
        run: |
          echo "Testing Copilot agent environment setup..."
          echo "Node.js version: $(node --version || echo 'N/A')"
          echo "npm version: $(npm --version || echo 'N/A')"
          echo "Git version: $(git --version)"
          echo "âœ“ Copilot agent environment verified"

      - name: Summary
        run: |
          echo "ðŸ¤– Copilot Agent Configuration Summary:"
          echo "  - Runner: ubuntu-latest âœ“"
          echo "  - Instructions file: Present âœ“"
          echo "  - Environment: Verified âœ“"
          echo "  - Repository: Ready for Copilot âœ“"
